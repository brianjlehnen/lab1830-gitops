# Production Vault - Stage 1: HTTP (for initialization)
vault:
  global:
    enabled: true
    tlsDisable: true
  
  injector:
    enabled: true
    replicas: 1
    image:
      repository: hashicorp/vault-k8s
      tag: "1.4.0"  # Stable vault-k8s version (not 1.20.1)
    resources:
      requests:
        memory: "64Mi"
        cpu: "50m"
      limits:
        memory: "128Mi"
        cpu: "100m"
  
  server:
    image:
      repository: hashicorp/vault
      tag: "1.20.1"  # CVE-2025-6000 patched version
    
    dev:
      enabled: false
    
    ha:
      enabled: true
      replicas: 2
      raft:
        enabled: true
        setNodeId: false
        config: |
          ui = true
          listener "tcp" {
            tls_disable = 1
            address = "[::]:8200"
            cluster_address = "[::]:8201"
          }
          storage "raft" {
            path = "/vault/data"
          }
          service_registration "kubernetes" {}
    
    standalone:
      enabled: false
    
    extraEnvironmentVars:
      VAULT_DISABLE_MLOCK: true
    
    resources:
      requests:
        memory: "256Mi"
        cpu: "100m"
      limits:
        memory: "512Mi"
        cpu: "500m"
    
    dataStorage:
      enabled: true
      size: "10Gi"
      storageClass: "local-path"
      accessMode: ReadWriteOnce
    
    service:
      enabled: true
      type: ClusterIP
      port: 8200
      targetPort: 8200
    
    ingress:
      enabled: true
      ingressClassName: nginx
      annotations:
        nginx.ingress.kubernetes.io/ssl-redirect: "true"
        nginx.ingress.kubernetes.io/backend-protocol: "HTTP"
        cert-manager.io/cluster-issuer: "letsencrypt-prod-gitops"
      hosts:
        - host: vault.lab1830.com
          paths:
            - "/"
      tls:
        - secretName: vault-tls-gitops
          hosts:
            - vault.lab1830.com
  
  ui:
    enabled: true
    serviceType: "ClusterIP"
    externalPort: 8200