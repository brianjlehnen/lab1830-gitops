# Top-level values (overridden by ArgoCD applications)
bucketName: "velero-backups"
bucketPrefix: ""

# =============================================================================
# SECURITY WARNING: Default credentials below are for development/staging ONLY
# For production, create a Kubernetes secret 'velero-minio-credentials' with:
#   kubectl create secret generic velero-minio-credentials \
#     --namespace velero \
#     --from-literal=accessKey=<secure-access-key> \
#     --from-literal=secretKey=<secure-secret-key>
# Then override credentials in your ArgoCD application values
# =============================================================================

# Velero official chart values (updated for v5.x chart)
velero:
  # Velero server configuration
  image:
    repository: velero/velero
    tag: v1.12.1
    pullPolicy: IfNotPresent
  
  # Resources
  resources:
    requests:
      cpu: 500m
      memory: 128Mi
    limits:
      cpu: 1000m
      memory: 512Mi
  
  # Configuration (updated format)
  configuration:
    # Enable metrics for Prometheus scraping
    metricsAddress: "0.0.0.0:8085"
    
    # Backup storage location configuration
    backupStorageLocation:
      - name: nfs-backup
        provider: aws
        bucket: velero-backups
        config:
          region: homelab
          s3ForcePathStyle: "true"
          s3Url: "http://nfs-gateway.velero.svc.cluster.local:9000"
        accessMode: ReadWrite
    
    # Volume snapshot location configuration
    volumeSnapshotLocation:
      - name: restic
        provider: restic
    
    # Other configuration options
    features: ""
    logLevel: info
    logFormat: text
    defaultVolumeSnapshotLocations:
      restic: restic
    defaultBackupStorageLocation: nfs-backup
  
  # Enable node agent (for restic)
  deployNodeAgent: true
  
  # Credentials for S3 (MinIO gateway)
  credentials:
    useSecret: true
    name: velero-credentials
    secretContents:
      cloud: |
        [default]
        aws_access_key_id=velero
        aws_secret_access_key=velero123
  
  # Initialize with BSL and VSL
  initContainers:
    - name: velero-plugin-for-aws
      image: velero/velero-plugin-for-aws:v1.8.0
      imagePullPolicy: IfNotPresent
      volumeMounts:
        - mountPath: /target
          name: plugins
  
  # Backup schedules
  schedules:
    daily-cluster:
      disabled: false
      schedule: "0 1 * * *"  # Fixed cron format
      useOwnerReferencesInBackup: false
      template:
        includedNamespaces: ["*"]
        excludedNamespaces: ["velero"]
        defaultVolumesToFsBackup: true
        storageLocation: nfs-backup
        ttl: "168h" # 7 days

# NFS Gateway configuration (separate from Velero)
nfsGateway:
  enabled: true
  image:
    repository: minio/minio
    tag: RELEASE.2025-09-07T16-13-09Z
    pullPolicy: IfNotPresent
  credentials:
    accessKey: "velero"
    secretKey: "velero123"
  nfs:
    server: "192.168.4.159"
    path: "/volume1/Backups"
  resources:
    requests:
      cpu: 50m
      memory: 64Mi
    limits:
      cpu: 200m
      memory: 256Mi
  service:
    type: ClusterIP
    ports:
      api: 9000
      console: 9001

# Bucket auto-creation configuration
bucketInit:
  enabled: true
  mcVersion: "RELEASE.2024-07-31T15-58-33Z"
  minioService: "nfs-gateway"
  minioPort: 9000
  bucketName: velero-backups
  credentials:
    accessKeyId: "velero"
    secretAccessKey: "velero123"

# ServiceMonitor configuration for Prometheus monitoring
serviceMonitor:
  enabled: false  # Default disabled, enabled per environment
  additionalLabels: {}
  interval: 30s
  scrapeTimeout: 10s

# PrometheusRule for backup alerts
prometheusRule:
  enabled: false  # Default disabled, enabled per environment