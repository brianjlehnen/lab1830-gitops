# Restic backup configuration with Vault integration
image:
  repository: restic/restic
  tag: "0.16.4"
  pullPolicy: IfNotPresent

# Backup schedule configuration
schedule:
  # Daily PVC backup at 3 AM
  pvc: "0 3 * * *"
  # Weekly full backup on Sundays at 4 AM
  full: "0 4 * * 0"

# Vault integration
vault:
  enabled: true
  role: backup-service
  secretPath: secret/backup/restic/staging
  
# Restic repository configuration (injected from Vault)
repository:
  # These will be injected by Vault Agent
  # repository: "s3:http://minio.backup.svc.cluster.local:9000/restic-staging"
  # password: "staging-restic-password-123"
  # aws_access_key: "backup-staging" 
  # aws_secret_key: "backup-staging-secret"

# Backup targets
backup:
  # PVC backup configuration
  pvc:
    enabled: true
    # Namespaces to backup
    namespaces: ["default", "staging"]
    # Storage classes to include
    storageClasses: ["local-path", "nfs-client"]
  
  # Application data backup
  applications:
    enabled: true
    # Specific applications to backup
    targets:
      - name: test-app
        namespace: default
        path: /data

# Resources
resources:
  requests:
    cpu: 100m
    memory: 128Mi
  limits:
    cpu: 500m
    memory: 512Mi

# Service account (for Vault authentication)
serviceAccount:
  create: true
  name: restic-backup

# Security context
securityContext:
  runAsUser: 0  # Required for accessing PVC mounts
  runAsGroup: 0
  fsGroup: 0

# Node selector and affinity
nodeSelector: {}
tolerations: []
affinity: {}

# MinIO S3 gateway (for staging)
minio:
  enabled: true
  service:
    name: minio
    port: 9000
  credentials:
    # Injected by Vault
    accessKey: ""
    secretKey: ""
