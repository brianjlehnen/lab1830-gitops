{{- if .Values.vault.enabled }}
# Wiz API Token Secret from Vault
apiVersion: v1
kind: Secret
metadata:
  name: wiz-api-token
  namespace: {{ .Values.namespace.name }}
  annotations:
    vault.hashicorp.com/agent-inject: "true"
    vault.hashicorp.com/role: {{ .Values.vault.role }}
    vault.hashicorp.com/agent-inject-secret-clientId: "secret/data/wiz/credentials"
    vault.hashicorp.com/agent-inject-secret-clientToken: "secret/data/wiz/credentials"
    vault.hashicorp.com/agent-inject-template-clientId: |
      {{`{{- with secret "secret/data/wiz/credentials" -}}
      {{ .Data.data.clientId }}
      {{- end -}}`}}
    vault.hashicorp.com/agent-inject-template-clientToken: |
      {{`{{- with secret "secret/data/wiz/credentials" -}}
      {{ .Data.data.clientToken }}
      {{- end -}}`}}
  labels:
    app.kubernetes.io/name: wiz-connector
    app.kubernetes.io/component: security
type: Opaque
data: {} # Vault will populate this
---
# Docker Registry Secret from Vault
apiVersion: v1
kind: Secret
metadata:
  name: sensor-image-pull
  namespace: {{ .Values.namespace.name }}
  annotations:
    vault.hashicorp.com/agent-inject: "true"
    vault.hashicorp.com/role: {{ .Values.vault.role }}
    vault.hashicorp.com/agent-inject-secret-dockerconfigjson: "secret/data/wiz/registry"
    vault.hashicorp.com/agent-inject-template-dockerconfigjson: |
      {{`{{- with secret "secret/data/wiz/registry" -}}
      {
        "auths": {
          "{{ .Data.data.server }}": {
            "username": "{{ .Data.data.username }}",
            "password": "{{ .Data.data.password }}",
            "auth": "{{ printf "%s:%s" .Data.data.username .Data.data.password | b64enc }}"
          }
        }
      }
      {{- end -}}`}}
  labels:
    app.kubernetes.io/name: wiz-connector
    app.kubernetes.io/component: security
type: kubernetes.io/dockerconfigjson
data: {} # Vault will populate this
{{- end }}