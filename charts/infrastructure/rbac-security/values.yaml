# charts/infrastructure/rbac-security/values.yaml
# RBAC Security Configuration

# Service Accounts
serviceAccounts:
  - name: monitoring-reader
    namespace: monitoring-production
  - name: backup-operator
    namespace: velero
  - name: security-manager
    namespace: security

# ClusterRoles
clusterRoles:
  monitoringReader:
    name: monitoring-reader
    rules:
      - apiGroups: [""]
        resources: ["pods", "services", "endpoints", "persistentvolumeclaims", "events", "configmaps", "secrets", "nodes", "nodes/proxy", "nodes/metrics"]
        verbs: ["get", "list", "watch"]
      - apiGroups: ["extensions", "apps"]
        resources: ["deployments", "daemonsets", "replicasets", "statefulsets"]
        verbs: ["get", "list", "watch"]
      - apiGroups: ["monitoring.coreos.com"]
        resources: ["*"]
        verbs: ["get", "list", "watch"]
      - nonResourceURLs: ["/metrics", "/metrics/*"]
        verbs: ["get"]

  backupOperator:
    name: velero-backup-operator
    rules:
      # Core API resources for backup
      - apiGroups: [""]
        resources: ["namespaces", "persistentvolumes", "persistentvolumeclaims", "pods", "secrets", "services", "configmaps", "serviceaccounts", "events"]
        verbs: ["get", "list", "watch", "create", "update", "patch", "delete"]
      - apiGroups: [""]
        resources: ["pods/exec", "pods/log"]
        verbs: ["get", "create"]
      # Apps resources
      - apiGroups: ["apps"]
        resources: ["deployments", "daemonsets", "replicasets", "statefulsets"]
        verbs: ["get", "list", "watch", "create", "update", "patch", "delete"]
      # Batch resources
      - apiGroups: ["batch"]
        resources: ["jobs", "cronjobs"]
        verbs: ["get", "list", "watch", "create", "update", "patch", "delete"]
      # Networking resources
      - apiGroups: ["networking.k8s.io"]
        resources: ["ingresses", "networkpolicies"]
        verbs: ["get", "list", "watch", "create", "update", "patch", "delete"]
      # RBAC resources
      - apiGroups: ["rbac.authorization.k8s.io"]
        resources: ["roles", "rolebindings", "clusterroles", "clusterrolebindings"]
        verbs: ["get", "list", "watch", "create", "update", "patch", "delete"]
      # Velero CRDs
      - apiGroups: ["velero.io"]
        resources: ["*"]
        verbs: ["*"]
      # Storage resources
      - apiGroups: ["storage.k8s.io"]
        resources: ["storageclasses", "volumeattachments"]
        verbs: ["get", "list", "watch"]
      # CRD management for restores
      - apiGroups: ["apiextensions.k8s.io"]
        resources: ["customresourcedefinitions"]
        verbs: ["get", "list", "watch", "create", "update", "patch", "delete"]
      # Snapshot resources
      - apiGroups: ["snapshot.storage.k8s.io"]
        resources: ["volumesnapshots", "volumesnapshotcontents", "volumesnapshotclasses"]
        verbs: ["get", "list", "watch", "create", "update", "patch", "delete"]

  networkSecurityManager:
    name: network-security-manager
    rules:
      - apiGroups: ["networking.k8s.io"]
        resources: ["networkpolicies"]
        verbs: ["get", "list", "watch", "create", "update", "patch", "delete"]
      - apiGroups: [""]
        resources: ["namespaces", "pods"]
        verbs: ["get", "list", "watch"]

# Roles (namespace-specific)
roles:
  developer:
    namespace: applications
    rules:
      - apiGroups: [""]
        resources: ["pods", "services", "configmaps", "persistentvolumeclaims"]
        verbs: ["get", "list", "watch", "create", "update", "patch", "delete"]
      - apiGroups: ["apps"]
        resources: ["deployments", "replicasets"]
        verbs: ["get", "list", "watch", "create", "update", "patch", "delete"]
      - apiGroups: [""]
        resources: ["secrets"]
        verbs: ["get", "list", "watch"]

# ClusterRoleBindings
clusterRoleBindings:
  - name: monitoring-reader-binding
    clusterRole: monitoring-reader
    serviceAccount: monitoring-reader
    namespace: monitoring-production
  - name: backup-operator-binding
    clusterRole: velero-backup-operator
    serviceAccount: backup-operator
    namespace: velero
  - name: network-security-manager-binding
    clusterRole: network-security-manager
    serviceAccount: security-manager
    namespace: security